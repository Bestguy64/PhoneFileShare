<!doctype html>
<html>
<head><meta charset=\"utf-8\"><title>Phone File Share</title></head>
<body>
  <h2>Phone File Share</h2>

  <form id=\"uploadForm\" method=\"post\" action=\"/upload\" enctype=\"multipart/form-data\">
    <input type=\"file\" name=\"file\" id=\"fileInput\" />
    <button type=\"submit\">Upload</button>
  </form>

  <h3>Available files</h3>
  <ul id=\"fileList\"></ul>

<script>
async function refreshList() {
  try {
    const res = await fetch('/list');
    if (!res.ok) return;
    const files = await res.json();
    const ul = document.getElementById('fileList');
    ul.innerHTML = '';
    files.forEach(f => {
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '/files/' + encodeURIComponent(f);
      a.textContent = f;
      a.setAttribute('download','');
      li.appendChild(a);
      ul.appendChild(li);
    });
  } catch(e) {
    console.log(e);
  }
}

document.getElementById('uploadForm').addEventListener('submit', async (ev) => {
  ev.preventDefault();
  const input = document.getElementById('fileInput');
  if (input.files.length === 0) return;
  const data = new FormData();
  data.append('file', input.files[0]);
  const resp = await fetch('/upload', { method: 'POST', body: data });
  if (resp.ok) {
    alert('Upload complete');
    refreshList();
  } else {
    alert('Upload failed');
  }
});

refreshList();
setInterval(refreshList, 5000);
</script>
</body>
</html>
